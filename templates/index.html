<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat App</title>
    <!-- Use Socket.IO client version compatible with Flask-SocketIO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <style>
        /* Your existing CSS styles */
    </style>
</head>
<body>
    <h1>Chat App</h1>
    <div id="chat"></div>
    <input id="message-input" placeholder="Type your message..." autocomplete="off" />
    <button id="send-button">Send</button>
    <script>
        const socket = io();

        const chatDiv = document.getElementById('chat');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        let username;

        // Set up event handlers
        socket.on('connect', function() {
            // Prompt user for username after connecting
            username = prompt("Enter your username:");
            socket.emit('set_username', username);
        });

        socket.on('previous_messages', function(messages) {
            messages.forEach(function(data) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.innerHTML = `<strong>${data.username}</strong>: ${data.content} <span class="timestamp">${data.timestamp}</span>`;
                chatDiv.appendChild(messageElement);
            });
            chatDiv.scrollTop = chatDiv.scrollHeight;
        });

        // Listen for incoming messages
        socket.on('message', function(data) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.innerHTML = `<strong>${data.username}</strong>: ${data.content} <span class="timestamp">${data.timestamp}</span>`;
            chatDiv.appendChild(messageElement);
            chatDiv.scrollTop = chatDiv.scrollHeight;
        });

        // Send message on button click
        sendButton.onclick = function() {
            const content = messageInput.value.trim();
            if (content) {
                socket.emit('message', {
                    'username': username,
                    'content': content
                });
                messageInput.value = '';
            }
        };

        // Send message on Enter key press
        messageInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendButton.click();
            }
        });
    </script>
</body>
</html>
